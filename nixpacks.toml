# Nixpacks configuration for Railway deployment
[phases.setup]
# Use Node.js 22 (LTS) for consistency, plus Python and build tools for native addons
nixPkgs = ["nodejs_22", "yarn", "python3", "gcc", "gnumake", "pkg-config"]

[phases.install]
cmds = ["yarn install --frozen-lockfile"]

[phases.build]
cmds = [
  "yarn run build",
  "cp -r public .next/standalone/",
  "cp -r .next/static .next/standalone/.next/",
  "cp -r drizzle .next/standalone/",
  "mkdir -p .next/standalone/data",
  "echo '{\"version\":1,\"setupComplete\":false,\"preferences\":{},\"personalization\":{},\"modelProviders\":[],\"search\":{\"searxngURL\":\"\"}}' > .next/standalone/data/config.json"
]

[start]
cmd = "cd .next/standalone && node server.js"
